swift newbie gcd dispatchqueue global qos background async code execute healthkit queries executing query wait implemented sleep loop class static protecteddataencrypted bool denote applehealth data encrypted unaccessible false ensure gcd main thread check sleep static protecteddataencrypted bool freeze app approach works convinced won deadlock gcd reason uses main thread check sleep static bool better approach sleep code appdelegate following separate class method invoked dispatchqueue global qos background async code following method called executing healthkit query note dispatchqueue global qos background sync invoke thread sleep prevent freezing thread sleep freeze rapidly locking unlocking screen continuously works convinced work time thanks advance
