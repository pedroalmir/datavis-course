adding logic optional argument custom hl7 parsing function wrote custom function parses hl7 interface message messages healthcare information system basically long text string delimited various character indicate different field paste cell excel function created searches counts find fields specified arguments disclaimer new vba teaching online research trial error past weeks vba expert prefer array tried code got complex troubleshoot code easy follow opposed fastest efficient got working pretty stuck adding logic optional argument work formula note arguments result result note know told stop instance hl7 subfield delimiter formula note optional 4th argument result formula note optional 4th argument result content value cell vba code sorry comment learning problem split function put array needed search 1st kwsegmentstringtosearchfor msh pv1 couting pipe character array separate nested array got way confusing abandoned split function initial plan array wrote find thing sequentially searches kwsegmentstringtosearchfor msh pv1 instr counts pipe character determine number field return string variable length delimited special character determine character return mid function search delimiter field found starting point call end field issue logic consider possible delimiters end field take code wouldn know end string add sort statement optional 4th argument exists sure ignore delimiter return full field adt wouldn return sub field component thanks