xquery support tree structure query implemented tree structure query mechanism sql entity value attribute based database design wanted performance functionality xquery based approach assuming possible xquery task simplified form tree xlm document follows different types node attribute query archetype node attribute node test query attempted write aims select evaluation node right element nodes query implementation requires key capability language ability support structural definition boolean operator ability define constraint attributes nodes xml attribute case xquery problem manage declare reference nodes interest node interested graph figure return match match right hand side tree composition evaluation turn elements 1st naive attempt flwr problem end pushing evaluation element nodes subquery filtering based attribute values location work introduce global variable main flowr body clueless comes returning result did ask separate question ideally enforce constraint evaluation having element at0002 at0003 code right hand side tree constraint element tree doable xquery works test existence structure looking tree access individual node update 2nd attempt actually opens door trying sure right way xquery ask question improving approach basically enforce parent child relation statement return values corresponding matches turn tree