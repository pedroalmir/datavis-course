thread main thread wait class static bool variabl true swift newbi gcd dispatchqueu global background async code execut healthkit queri execut queri wait implement sleep loop class static protecteddataencrypt bool denot applehealth data encrypt unaccess fals ensur gcd main thread check sleep static protecteddataencrypt bool freez app approach work convinc won deadlock gcd reason main thread check sleep static bool better approach sleep code appdeleg follow separ class method invok dispatchqueu global background async code follow method call execut healthkit queri note dispatchqueu global background sync invok thread sleep prevent freez thread sleep freez rapidli lock unlock screen continu work convinc work time thank advanc